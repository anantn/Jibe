<!doctype html public "âœ°">
<!--[if lt IE 7]> <html lang="en-us" class="no-js ie6"> <![endif]-->
<!--[if IE 7]> <html lang="en-us" class="no-js ie7"> <![endif]-->
<!--[if IE 8]> <html lang="en-us" class="no-js ie8"> <![endif]-->
<!--[if gt IE 8]><!--> <html lang="en-us" class="no-js"> <!--<![endif]-->
<head>
    <script src="js/jschannel.js" type="text/javascript"></script>
    <script type="text/javascript">
        var _channel = Channel.build({
            window: window.parent,
            origin: "*",
            scope: "openwebapps"
        });

        _channel.bind("install", function(trans, param) {
            
        });

        _channel.bind("list", function(trans, param) {
            trans.delayReturn(true);

            var req = new XMLHttpRequest();
            req.open('POST', '/repo/list', true);
            req.onreadystatechange = function(event) {
                if (req.readyState == 4) {
                    if (req.status == 200) {
                        trans.complete(req.responseText);
                    } else {
                        trans.error(req.responseText);
                    }
                }
            };

            /* Note that the audience is localhost not localhost:8080
             * This will be fixed by a new BrowserID feature which allows
             * sites to request authorization for other domains. */
            var sreq = JSON.stringify({"assertion": param, "audience": "http://localhost"});
            req.setRequestHeader("Content-Type", "application/json");
            req.setRequestHeader("Content-Length", sreq.length);
            req.send(sreq);
        });
    </script>
</head>
</html>