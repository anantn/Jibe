<!doctype html public "âœ°">
<!--[if lt IE 7]> <html lang="en-us" class="no-js ie6"> <![endif]-->
<!--[if IE 7]> <html lang="en-us" class="no-js ie7"> <![endif]-->
<!--[if IE 8]> <html lang="en-us" class="no-js ie8"> <![endif]-->
<!--[if gt IE 8]><!--> <html lang="en-us" class="no-js"> <!--<![endif]-->
<head>
    <script type="text/javascript">
        var origin = "http://localhost";

        function handleInstall(record, source) {
            
        };

        function handleList(assertion, source) {
            var req = new XMLHttpRequest();
            req.open('POST', '/repo/list', true);
            req.onreadystatechange = function(event) {
                if (req.readyState == 4) {
                    if (req.status == 200) {
                        var msg = {"action":"list", "result":req.responseText};
                        source.postMessage(JSON.stringify(msg), origin);
                    } else {
                        var msg = {"action":"list", "error":req.responseText};
                        source.postMessage(JSON.stringify(msg), origin);
                    }
                }
            };
            var sreq = JSON.stringify({"assertion":assertion, "audience":origin});
            req.setRequestHeader("Content-Type", "application/json");
            req.setRequestHeader("Content-Length", sreq.length);
            req.send(sreq);
        };

        window.addEventListener("message", function(event) {
            // Only accept messaages from dashboard
            if (event.origin == origin) {
                var data = JSON.parse(event.data);
                switch (data.action) {
                    case "list":
                        handleList(data.assertion, event.source);
                        break;
                    case "install":
                        handleList(data.record, event.source);
                        break;
                    default:
                        var msg = {"action":"undefined", "error":""};
                        event.source.postMessage(JSON.stringify(msg), origin);
                }
            }
        }, false);
    </script>
</head>
</html>